---
title: "Next.js Integration"
description: "Use Signal JS with Next.js App Router and Pages Router"
---

# Next.js Integration

Use Signal JS with Next.js using the `@signal-js/nextjs` package, which provides components and utilities for both App Router and Pages Router.

## Installation

```bash
npm install @signal-js/nextjs
```

> **Note:** `@signal-js/nextjs` includes both the browser SDK (`@signal-js/browser`) and server SDK (`@signal-js/node`) automatically. You don't need to install them separately.

## Client-Side Setup (App Router)

### Providers Setup

```tsx
// app/providers.tsx
'use client';

import { SignalNextProvider } from '@signal-js/nextjs/client';

export function Providers({ children }) {
  return (
    <SignalNextProvider
      options={{
        endpoint: process.env.NEXT_PUBLIC_SIGNAL_ENDPOINT!,
        apiKey: process.env.NEXT_PUBLIC_SIGNAL_API_KEY!,
        projectId: process.env.NEXT_PUBLIC_SIGNAL_PROJECT_ID!,
        // Enable tracing headers to share sessionId/windowId with server
        addTracingHeaders: true, // or ['localhost', 'api.example.com'] for specific hostnames
      }}
      trackPageViews
      trackWebVitals
    >
      {children}
    </SignalNextProvider>
  );
}
```

### Root Layout

```tsx
// app/layout.tsx
import { Providers } from './providers';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        <Providers>{children}</Providers>
      </body>
    </html>
  );
}
```

## Server-Side Tracking (App Router)

### Server SDK Setup

```typescript
// lib/signal-server.ts
import { createSignalServer } from '@signal-js/nextjs/server';

export const signal = createSignalServer({
  endpoint: process.env.SIGNAL_ENDPOINT!,
  apiKey: process.env.SIGNAL_API_KEY!,
  projectId: process.env.SIGNAL_PROJECT_ID!,
});

// Helper to extract session info from request headers
export function getSessionInfo(request: Request) {
  return {
    sessionId: request.headers.get('x-signal-session-id') || undefined,
    windowId: request.headers.get('x-signal-window-id') || undefined,
    distinctId: request.headers.get('x-signal-distinct-id') || undefined,
  };
}
```

### API Routes

```typescript
// app/api/checkout/route.ts
import { signal, getSessionInfo } from '@/lib/signal-server';
import { NextRequest } from 'next/server';

export async function POST(request: NextRequest) {
  const { sessionId, windowId, distinctId } = getSessionInfo(request);
  const body = await request.json();
  
  // Process checkout...
  const orderId = await processOrder(body);
  
  // Track server-side event with same session identifiers
  await signal.capture({
    distinctId: distinctId || body.userId, // Use header or fallback
    event: 'order_processed',
    properties: {
      orderId,
      amount: body.amount,
    },
    sessionId,  // Links to client-side session replay
    windowId,   // Links to specific browser tab
  });
  
  return Response.json({ success: true, orderId });
}
```

### Server Actions

```typescript
// app/actions.ts
'use server';

import { signal, getSessionInfo } from '@/lib/signal-server';
import { headers } from 'next/headers';

export async function processOrderAction(orderData: OrderData) {
  // Get headers from Next.js headers() function
  const headersList = headers();
  const sessionId = headersList.get('x-signal-session-id') || undefined;
  const windowId = headersList.get('x-signal-window-id') || undefined;
  const distinctId = headersList.get('x-signal-distinct-id') || undefined;
  
  // Process order...
  const orderId = await processOrder(orderData);
  
  // Track with same session identifiers
  await signal.capture({
    distinctId: distinctId || orderData.userId,
    event: 'order_processed',
    properties: { orderId, amount: orderData.amount },
    sessionId,
    windowId,
  });
  
  return { success: true, orderId };
}
```

## Pages Router

### API Routes

```typescript
// pages/api/orders.ts
import { NextApiRequest, NextApiResponse } from 'next';
import { signal } from '@/lib/signal-server';

function getSessionInfo(req: NextApiRequest) {
  return {
    sessionId: req.headers['x-signal-session-id'] as string | undefined,
    windowId: req.headers['x-signal-window-id'] as string | undefined,
    distinctId: req.headers['x-signal-distinct-id'] as string | undefined,
  };
}

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const { sessionId, windowId, distinctId } = getSessionInfo(req);
  
  // Process order...
  const orderId = await processOrder(req.body);
  
  // Track with same session identifiers
  await signal.capture({
    distinctId: distinctId || req.body.userId,
    event: 'order_created',
    properties: { orderId },
    sessionId,
    windowId,
  });
  
  res.json({ success: true, orderId });
}
```

### getServerSideProps

```typescript
// pages/dashboard.tsx
import { GetServerSideProps } from 'next';
import { signal } from '@/lib/signal-server';

export const getServerSideProps: GetServerSideProps = async (context) => {
  // Extract session info from request headers
  const sessionId = context.req.headers['x-signal-session-id'] as string | undefined;
  const windowId = context.req.headers['x-signal-window-id'] as string | undefined;
  const distinctId = context.req.headers['x-signal-distinct-id'] as string | undefined;
  
  // Track page view on server
  await signal.capture({
    distinctId: distinctId || 'anonymous',
    event: '$pageview',
    properties: {
      path: context.resolvedUrl,
    },
    sessionId,
    windowId,
  });
  
  return {
    props: {
      // Your page props
    },
  };
};
```

## Environment Variables

Create a `.env.local` file:

```bash
NEXT_PUBLIC_SIGNAL_ENDPOINT=https://your-api.com/api/signal/v1
NEXT_PUBLIC_SIGNAL_API_KEY=your-api-key
NEXT_PUBLIC_SIGNAL_PROJECT_ID=your-project-id

# Server-side only (not exposed to client)
SIGNAL_ENDPOINT=https://your-api.com/api/signal/v1
SIGNAL_API_KEY=your-api-key
SIGNAL_PROJECT_ID=your-project-id
```

## Features

- **App Router support** - Full support for Next.js 13+ App Router
- **Pages Router support** - Compatible with Pages Router
- **Server-side tracking** - Track events from API routes and server actions
- **Session correlation** - Link client and server events using tracing headers
- **Web Vitals tracking** - Automatic Core Web Vitals tracking
- **Page view tracking** - Automatic page view tracking

## Best Practices

1. **Use environment variables** - Store credentials in `.env.local`
2. **Enable tracing headers** - Set `addTracingHeaders: true` for session correlation
3. **Track server events** - Use the same session identifiers from headers
4. **Use Web Vitals** - Enable `trackWebVitals` for performance monitoring
5. **Separate client/server configs** - Use `NEXT_PUBLIC_` prefix for client-side variables
