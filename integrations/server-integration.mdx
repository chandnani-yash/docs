---
title: "Server-Side Integration"
description: "Integrate Signal JS with server-side applications"
---

# Server-Side Integration

Integrate Signal JS with server-side applications to track events and correlate them with client-side sessions.

## How It Works

Signal JS uses **tracing headers** to link client and server events:

1. **Client SDK** generates `sessionId` and `windowId` when initialized
2. **Tracing headers** automatically add these to all fetch/XHR requests:
   - `X-Signal-Session-Id`: Browser's session ID
   - `X-Signal-Window-Id`: Browser's window/tab ID
   - `X-Signal-Distinct-Id`: User's distinct ID (if identified)
3. **Server** extracts these headers and uses them when tracking events
4. **Result**: All events (client and server) share the same identifiers

## Client-Side Configuration

Enable tracing headers in your client SDK:

```typescript
import { createSignal } from '@signal-js/browser';

const signal = createSignal({
  endpoint: 'https://your-api.com/api/signal/v1',
  apiKey: 'your-api-key',
  projectId: 'your-project-id',
  
  // Enable tracing headers for all requests
  addTracingHeaders: true,
  
  // OR specify hostnames to add headers only to specific domains
  addTracingHeaders: ['api.example.com', 'localhost'],
});
```

## Express.js / Node.js

### Installation

```bash
npm install @signal-js/node
```

### Setup

```typescript
import express from 'express';
import { createSignalNode } from '@signal-js/node';

const app = express();
const signal = createSignalNode({
  endpoint: process.env.SIGNAL_ENDPOINT!,
  apiKey: process.env.SIGNAL_API_KEY!,
  projectId: process.env.SIGNAL_PROJECT_ID!,
});

// Helper to extract session info
function getSessionInfo(req: express.Request) {
  return {
    sessionId: req.headers['x-signal-session-id'] as string | undefined,
    windowId: req.headers['x-signal-window-id'] as string | undefined,
    distinctId: req.headers['x-signal-distinct-id'] as string | undefined,
  };
}
```

### API Route Example

```typescript
// API route with session correlation
app.post('/api/checkout', async (req, res) => {
  const { sessionId, windowId, distinctId } = getSessionInfo(req);
  const { userId, amount } = req.body;
  
  // Process checkout...
  const orderId = await processOrder(userId, amount);
  
  // Track server event with same session identifiers
  await signal.capture({
    distinctId: distinctId || userId,
    event: 'checkout_completed',
    properties: { orderId, amount },
    sessionId,  // Links to client session replay
    windowId,   // Links to specific browser tab
  });
  
  res.json({ success: true, orderId });
});
```

### Middleware for Automatic Tracking

```typescript
// Middleware for automatic request tracking
app.use((req, res, next) => {
  const { sessionId, windowId, distinctId } = getSessionInfo(req);
  
  res.on('finish', () => {
    signal.capture({
      distinctId: distinctId || 'anonymous',
      event: 'api_request',
      properties: {
        method: req.method,
        path: req.path,
        statusCode: res.statusCode,
      },
      sessionId,
      windowId,
    });
  });
  
  next();
});
```

## Python (Flask/FastAPI)

### Installation

```bash
pip install signal-python
```

### Flask Example

```python
from flask import Flask, request
from signal_python import create_signal_client

app = Flask(__name__)
signal = create_signal_client(
    endpoint=os.getenv('SIGNAL_ENDPOINT'),
    api_key=os.getenv('SIGNAL_API_KEY'),
    project_id=os.getenv('SIGNAL_PROJECT_ID'),
)

def get_session_info():
    """Extract session info from request headers"""
    return {
        'session_id': request.headers.get('X-Signal-Session-Id'),
        'window_id': request.headers.get('X-Signal-Window-Id'),
        'distinct_id': request.headers.get('X-Signal-Distinct-Id'),
    }

@app.route('/api/checkout', methods=['POST'])
def checkout():
    session_info = get_session_info()
    data = request.json
    
    # Process checkout...
    order_id = process_order(data)
    
    # Track with same session identifiers
    signal.capture(
        distinct_id=session_info['distinct_id'] or data['user_id'],
        event='checkout_completed',
        properties={'order_id': order_id, 'amount': data['amount']},
        session_id=session_info['session_id'],
        window_id=session_info['window_id'],
    )
    
    return {'success': True, 'order_id': order_id}
```

### FastAPI Example

```python
from fastapi import FastAPI, Request
from signal_python import create_signal_client

app = FastAPI()
signal = create_signal_client(
    endpoint=os.getenv('SIGNAL_ENDPOINT'),
    api_key=os.getenv('SIGNAL_API_KEY'),
    project_id=os.getenv('SIGNAL_PROJECT_ID'),
)

def get_session_info(request: Request):
    """Extract session info from request headers"""
    return {
        'session_id': request.headers.get('x-signal-session-id'),
        'window_id': request.headers.get('x-signal-window-id'),
        'distinct_id': request.headers.get('x-signal-distinct-id'),
    }

@app.post('/api/checkout')
async def checkout(request: Request):
    session_info = get_session_info(request)
    data = await request.json()
    
    # Process checkout...
    order_id = process_order(data)
    
    # Track with same session identifiers
    signal.capture(
        distinct_id=session_info['distinct_id'] or data['user_id'],
        event='checkout_completed',
        properties={'order_id': order_id, 'amount': data['amount']},
        session_id=session_info['session_id'],
        window_id=session_info['window_id'],
    )
    
    return {'success': True, 'order_id': order_id}
```

## Benefits of Session Correlation

When server and client events share the same identifiers:

✅ **Complete User Journey**: See both browser interactions and server-side business logic in one session replay  
✅ **Debugging**: Correlate API errors with the exact user actions that caused them  
✅ **Analytics**: Track end-to-end user flows from frontend to backend  
✅ **Performance**: Link server response times to specific user interactions  

## Example: Complete User Journey

```typescript
// 1. User clicks "Checkout" button → Client SDK records click
// (handled automatically by browser SDK)

// 2. Frontend makes API call → Client SDK captures network request
fetch('/api/checkout', {
  method: 'POST',
  body: JSON.stringify({ userId: 'user_123', amount: 99.99 })
});
// Browser SDK automatically adds: X-Signal-Session-Id, X-Signal-Window-Id headers

// 3. Server processes checkout → Server SDK tracks business event
app.post('/api/checkout', async (req, res) => {
  const sessionId = req.headers['x-signal-session-id'];
  const windowId = req.headers['x-signal-window-id'];
  const distinctId = req.headers['x-signal-distinct-id'];
  
  signal.capture({
    distinctId: distinctId || req.body.userId,
    event: 'checkout_completed',
    properties: { amount: req.body.amount },
    sessionId,  // Same as client session
    windowId,  // Same as client window
  });
  
  res.json({ success: true });
});

// Result: Both events linked by same sessionId, windowId, and distinctId
```

## Best Practices

1. **Always extract headers** - Use the tracing headers to get session identifiers
2. **Fallback to user ID** - Use `distinctId` from headers or fallback to your user ID
3. **Track key events** - Track important business events on the server
4. **Use middleware** - Set up middleware for automatic request tracking
5. **Test correlation** - Verify that client and server events are linked correctly
